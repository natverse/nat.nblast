<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Neuron similarity, search and clustering tools — nat.nblast-package • nat.nblast</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Neuron similarity, search and clustering tools — nat.nblast-package"><meta name="description" content="nat.nblast provides tools to compare neuronal morphology using the
NBLAST algorithm (Costa et al. 2016)."><meta property="og:description" content="nat.nblast provides tools to compare neuronal morphology using the
NBLAST algorithm (Costa et al. 2016)."><meta property="og:image" content="https://natverse.org/nat.nblast/logo.svg"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">nat.nblast</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.6.9</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home fa-lg"></span></a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/NBLAST-Clustering.html">NBLAST Clustering</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item"><a class="nav-link" href="../SUPPORT.html">Help</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://natverse.github.io">natverse</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/natverse/nat.nblast"><span class="fa fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Neuron similarity, search and clustering tools</h1>
      <small class="dont-index">Source: <a href="https://github.com/natverse/nat.nblast/blob/master/R/nat.nblast.r" class="external-link"><code>R/nat.nblast.r</code></a></small>
      <div class="d-none name"><code>nat.nblast-package.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><b>nat.nblast</b> provides tools to compare neuronal morphology using the
NBLAST algorithm (Costa et al. 2016).</p>
    </div>


    <div class="section level2">
    <h2 id="similarity-and-search">Similarity and search<a class="anchor" aria-label="anchor" href="#similarity-and-search"></a></h2>



<p>The main entry point for similarity and search functions is
  <code><a href="nblast.html">nblast</a></code>. Traced neurons will normally be converted to the
  <code><a href="https://rdrr.io/pkg/nat/man/dotprops.html" class="external-link">dotprops</a></code> format for search. When multiple neurons are
  compared they should be in a <code><a href="https://rdrr.io/pkg/nat/man/neuronlist.html" class="external-link">neuronlist</a></code> object.</p>
<p>The current NBLAST version (2) depends on a scoring matrix. Default
  matrices trained using <em>Drosophila</em> neurons in the FCWB template brain
  space are distributed with this package (see <code><a href="smat.fcwb.html">smat.fcwb</a></code>); see
  <b>Scoring Matrices</b> section below for creating new scoring matrices.</p>
<p><code>nblast</code> makes use of a more flexible but more complicated function
  <code>NeuriteBlast</code> which includes several additional options. The function
  <code>WeightedNNBasedLinesetMatching</code> provides the primitive functionality
  of finding the nearest neighbour distances and absolute dot products for
  two sets of segments. Neither of these functions are intended for end use.</p>
<p>Calculating all by all similarity scores is facilitated by the
  <code><a href="nblast_allbyall.html">nblast_allbyall</a></code> function which can take either a
  <code><a href="https://rdrr.io/pkg/nat/man/neuronlist.html" class="external-link">neuronlist</a></code> as input or a character vector naming (a
  subset) of neurons in a (large) <code><a href="https://rdrr.io/pkg/nat/man/neuronlist.html" class="external-link">neuronlist</a></code>. The
  <code><a href="https://rdrr.io/pkg/nat/man/neuronlist.html" class="external-link">neuronlist</a></code> containing the input neurons should be
  resident in memory i.e. not the <code><a href="https://rdrr.io/pkg/nat/man/neuronlistfh.html" class="external-link">neuronlistfh</a></code>.</p>
    </div>
    <div class="section level2">
    <h2 id="clustering">Clustering<a class="anchor" aria-label="anchor" href="#clustering"></a></h2>



<p>Once an all by all similarity score matrix is available it can be used as
  the input to a variety of clustering algorithms. <code><a href="nhclust.html">nhclust</a></code>
  provides a convenient wrapper for R's hierarchical clustering function
  <code><a href="https://rdrr.io/r/stats/hclust.html" class="external-link">hclust</a></code>. If you wish to use another clustering function, then
  you can use the <code><a href="sub_dist_mat.html">sub_dist_mat</a></code> to convert a raw similarity
  score matrix into a normalised distance matrix (or R <code><a href="https://rdrr.io/r/stats/dist.html" class="external-link">dist</a></code>
  object) suitable for clustering. If you need a similarity matrix or want to
  modify the normalisation then you can use <code><a href="sub_score_mat.html">sub_score_mat</a></code>.</p>
<p>Note that raw NBLAST scores are not symmetric (i.e. S(A,B) is not equal to
  S(B,A)) so before clustering we construct a symmetric similarity/distance
  matrix <code>1/2 * ( S(A,B)/S(A,A) + S(B,A)/S(B,B) )</code>. See
  <code><a href="sub_score_mat.html">sub_score_mat</a></code>'s documentation for details.</p>
    </div>
    <div class="section level2">
    <h2 id="cached-scores">Cached scores<a class="anchor" aria-label="anchor" href="#cached-scores"></a></h2>



<p>Although NBLAST is fast and can be parallelised, it makes sense to cache to
  disk all by all similarity scores for a group of neurons that will be
  subject to repeated clustering or other analysis. The matrix can simply be
  saved to disk and then reloaded using base R functions like
  <code><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></code> and <code><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></code>. <code><a href="sub_score_mat.html">sub_score_mat</a></code> and
  <code><a href="sub_dist_mat.html">sub_dist_mat</a></code> can be used to extract a subset of scores from
  this raw score matrix. For large matrices, the <code>bigmemory</code> or
  <code>ff</code> packages allow matrices to be stored on disk and portions loaded
  into memory on demand. <code><a href="sub_score_mat.html">sub_score_mat</a></code> and
  <code><a href="sub_dist_mat.html">sub_dist_mat</a></code> work equally well for regular in-memory matrices
  and these disk-backed matrices.</p>
<p>To give an example, for 16,129 neurons from the flycircuit.tw dataset, the
  260,144,641 comparisons took about 250 hours of compute time (half a day on
  ~20 cores). When saved to disk as single precision (i.e. 4 bytes per score)
  <code>ff</code> matrix they occupy just over 1Gb.</p>
    </div>
    <div class="section level2">
    <h2 id="calculating-scoring-matrices">Calculating scoring matrices<a class="anchor" aria-label="anchor" href="#calculating-scoring-matrices"></a></h2>



<p>The NBLAST algorithm depends on appropriately calibrated scoring matrices.
  These encapsulate the log odds ratio that a pair of segments come from two
  structurally related neurons rather than two unrelated neurons, given the
  observed distance and absolute dot product of the two segments. Scoring
  matrices can be constructed using the <code><a href="create_scoringmatrix.html">create_scoringmatrix</a></code>
  function, supplying a set of matching neurons and a set of non-matching
  neurons. See the <code>create_scoringmatrix</code> documentation for links to
  lower-level functions that provide finer control over construction of the
  scoring matrix.</p>
    </div>
    <div class="section level2">
    <h2 id="package-options">Package Options<a class="anchor" aria-label="anchor" href="#package-options"></a></h2>



<p>There is one package option <code>nat.nblast.defaultsmat</code> which is
  <code>NULL</code> by default, but could for example be set to one of the scoring
  matrices included with the package such as <code>"smat.fcwb"</code> or to a new
  user-constructed matrix.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Costa, M., Ostrovsky, A.D., Manton, J.D., Prohaska, S., and
  Jefferis, G.S.X.E. (2014). NBLAST: Rapid, sensitive comparison of neuronal
  structure and construction of neuron family databases. bioRxiv preprint.
  <a href="https://doi.org/10.1101/006346" class="external-link">doi:10.1101/006346</a>
.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="nblast.html">nblast</a></code>, <code><a href="smat.fcwb.html">smat.fcwb</a></code>,
  <code><a href="nhclust.html">nhclust</a></code>, <code><a href="sub_dist_mat.html">sub_dist_mat</a></code>,
  <code><a href="sub_score_mat.html">sub_score_mat</a></code>, <code><a href="create_scoringmatrix.html">create_scoringmatrix</a></code></p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p><strong>Maintainer</strong>: Gregory Jefferis <a href="mailto:jefferis@gmail.com">jefferis@gmail.com</a> (<a href="https://orcid.org/0000-0002-0587-9355" class="external-link">ORCID</a>)</p>
<p>Authors:</p><ul><li><p>James Manton <a href="mailto:ajd.manton@googlemail.com">ajd.manton@googlemail.com</a> (<a href="https://orcid.org/0000-0001-9260-3156" class="external-link">ORCID</a>)</p></li>
</ul></div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Gregory Jefferis, James Manton.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

